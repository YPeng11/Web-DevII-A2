<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity Events</title>
    <link rel="stylesheet" href="css/css.css">
    <link rel="stylesheet" href="css/detail.css">
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">Love Charity</div>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="search.html">Search Event</a>
                    <a href="event-detail.html">About Us</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="section" id="events">
        <div class="container">
            <h2 class="section-title">Charity Events</h2>
            <div class="events-container" id="events-container">
            </div>
        </div>
    </section>


    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact us</h3>
                    <p>Tel: (123) 456-7890</p>
                    <p>Email: charity@charity.com</p>
                    <p>Address: No. 123 Charity Road, Liuzhou City, Guangxi Zhuang Autonomous Region</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html" style="color: white;">Home</a><br>
                    <a href="search.html" style="color: white;">Search</a><br>
                </div>
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>A non-profit organization</p>
                    <p>Our mission is to convey love, create hope, and allow everyone to enjoy equal development
                        opportunities.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Love Charity</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            //get event id
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get('id');
            console.log('id',eventId)

            if (eventId) {
                loadEventDetails(eventId);
            } else {
                document.getElementById('events-container').innerHTML = ` No event id...`;
            }
        });


        // 从API获取数据
        async function loadEventDetails(eventId) {
            try {
                const response = await fetch(`http://localhost:3060/api/events/detail/${eventId}`);
                if (!response.ok) {
                    throw new Error('The network response is abnormal');
                }
                const event = await response.json();
                renderEventDetails(event);
            } catch (error) {
                console.error('Error getting event data:', error);
                document.getElementById('events-container').innerHTML = '<p>Unable to load Event data. Please try again later.</p>';
            }
        }


        // renderContainer
        function renderEventDetails(data) {

            // get container
            const eventsContainer = document.getElementById('events-container');
            eventsContainer.innerHTML = '';

            // Calculate event progress percentage
            const completionRate = (data.price / data.target_price) * 100;
            
            // event status
            const isActive = data.event_status === 1;
            const statusText = isActive ? "Ongoing" : "Past";
            const statusClass = isActive ? "status-ongoing" : "status-ended";

            if (!data || Object.keys(data).length === 0) {
                eventsContainer.innerHTML = '<p>No event data is available.</p>';
                return;
            }
            const eventDate = new Date(data.date);


            // format date
            const formattedDate = `${eventDate.getFullYear()}/${eventDate.getMonth() + 1}/${eventDate.getDate()}`;

            console.log(data)

            eventsContainer.innerHTML = `
                        
                     <div class="event-header">
                    <h1 class="event-title">${data.name}</h1>
                    <div class="event-status ${statusClass}">                   
                        ${statusText}
                    </div>
                    <img src="./img/${data.id}.jpg" alt="${data.name}" class="event-image">
                </div>
                
                <div class="event-info">
                    <div class="info-section">
                        <h3 class="info-title">Event Detail</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Event Date</span>
                                <span class="info-value">${formattedDate}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label"> Category</span>
                                <span class="info-value">${data.category_name || 'Uncategorized'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Orgazation</span>
                                <span class="info-value">${data.organization_name || 'unknown organization'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3 class="info-title">Event Progress </h3>
                       
                        <div class="fundraising-numbers">
                            <div class="number-item">
                                <div class="number-value">$${data.price}</div>
                                <div class="number-label">Current Amount</div>
                            </div>
                            <div class="number-item">
                                <div class="number-value">$${data.target_price}</div>
                                <div class="number-label">Target Amount</div>
                            </div>
                            <div class="number-item">
                                <div class="number-value">${completionRate.toFixed(1)}%</div>
                                <div class="number-label">Completeness</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                    <button class="donate-btn" id="donateButton" ${isActive ? '' : 'disabled'}>
                        <i class="fas fa-heart"></i> ${isActive ? 'Donation Now' : 'Event Past'}
                    </button>
                    
                </div>
                    </div>
                </div>
                
                <div class="event-detail">
                    <h3 class="info-title">Event  Description</h3>
                    <div class="detail-content">
                        ${data.detail}
                    </div>
                </div>
                
                
                    `;

        }

    </script>
</body>

</html>