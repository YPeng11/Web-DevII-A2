<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>爱心慈善 - 主页</title>
    <link rel="stylesheet" href="css/css.css">
</head>

<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">爱心慈善</div>
                <div class="nav-links">
                    <a href="index.html">首页</a>
                    <a href="search.html">搜索活动</a>
                    <a href="event-detail.html">活动详情</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- 主横幅 -->
    <section class="hero">
        <div class="container">
            <h1>爱心慈善组织</h1>
            <p>我们致力于通过慈善活动帮助需要帮助的人们，创造更美好的社会。</p>
            <a href="#events" class="btn">查看活动</a>
        </div>
    </section>


    <!-- 活动列表 -->
    <section class="section" id="events">
        <div class="container">
            <h2 class="section-title">慈善活动</h2>
            <div class="events-container" id="events-container">
                <!-- 活动卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <!-- 关于我们 -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">关于我们</h2>
            <p>爱心慈善组织成立于2010年，是一个非营利性公益组织，致力于通过各类慈善活动改善弱势群体的生活状况。我们的使命是传递爱心，创造希望，让每个人都能享有平等的发展机会。</p>
            <p>在过去十年中，我们成功举办了数百场慈善活动，帮助了成千上万需要帮助的人们。我们的项目涵盖教育支持、医疗援助、灾难救助和社区发展等多个领域。</p>
        </div>
    </section>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>联系我们</h3>
                    <p>电话: (123) 456-7890</p>
                    <p>邮箱: info@charity.org</p>
                    <p>地址: 北京市朝阳区慈善路123号</p>
                </div>
                <div class="footer-section">
                    <h3>快速链接</h3>
                    <a href="index.html">首页</a><br>
                    <a href="search.html">搜索活动</a><br>
                    <a href="event-detail.html">活动详情</a>
                </div>
                <div class="footer-section">
                    <h3>关注我们</h3>
                    <p>微信公众号: 爱心慈善</p>
                    <p>微博: @爱心慈善官方</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 爱心慈善组织. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <script>

        // 从API获取数据
        async function fetchEvents() {
            try {
                const response = await fetch('http://localhost:3060/api/events');
                if (!response.ok) {
                    throw new Error('网络响应不正常');
                }
                const events = await response.json();
                renderEvents(events);
            } catch (error) {
                console.error('获取活动数据时出错:', error);
                // 可以在这里添加错误处理，比如显示错误信息
                eventsContainer.innerHTML = '<p>无法加载活动数据，请稍后重试。</p>';
            }
        }
        // 获取活动容器
        const eventsContainer = document.getElementById('events-container');

        // 渲染活动卡片
        function renderEvents(events) {
            // 清空容器
            eventsContainer.innerHTML = '';

            // 过滤掉不合法活动（状态为0）
            const validEvents = events.filter(event => event.status === "1");

            if (validEvents.length === 0) {
                eventsContainer.innerHTML = '<p>暂无活动数据。</p>';
                return;
            }

            // 对活动按日期排序
            validEvents.sort((a, b) => new Date(a.date) - new Date(b.date));

            // 创建活动卡片
            validEvents.forEach(event => {
                const eventDate = new Date(event.date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                // 确定活动状态
                let statusClass, statusText;
                if (eventDate < today) {
                    statusClass = 'status-past';
                    statusText = '已结束';
                } else {
                    statusClass = 'status-upcoming';
                    statusText = '即将开始';
                }

                // 格式化日期
                const formattedDate = `${eventDate.getFullYear()}/${eventDate.getMonth() + 1}/${eventDate.getDate()}`;

                // 创建卡片元素
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card';
                eventCard.innerHTML = `
                        
                        <div class="event-name">${event.name}</div>
                        <div class="event-organization">${event.organization_name}</div>
                        <p>${event.detail}</p>
                        <div class="event-date">${formattedDate}</div>
                        <div class="event-status ${statusClass}">${statusText}</div>
                        <a href="event-detail.html?id=${event.id}" class="btn">查看详情</a>
                    `;

                eventsContainer.appendChild(eventCard);
            });
        }

        // 页面加载完成后渲染活动
        document.addEventListener('DOMContentLoaded', fetchEvents);
    </script>
</body>

</html>