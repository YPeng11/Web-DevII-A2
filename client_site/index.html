<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity Events</title>
    <link rel="stylesheet" href="css/css.css">
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">Love Charity</div>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="search.html">Search Event</a>
                    <a href="#">About Us</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Charity Organization</h1>
            <p>We are committed to helping people in need through charity activities and creating a better society.</p>
        </div>
    </section>


    <section class="section" id="events">
        <div class="container">
            <h2 class="section-title">Charity Events</h2>
            <div class="events-container" id="events-container">
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <h2 class="section-title">About Us</h2>
            <p>Charity Organization, A non-profit organization, is committed to improving the living conditions of
                vulnerable groups through various charitable activities. Our mission is to convey love, create hope, and
                allow everyone to enjoy equal development opportunities.</p>
            <p>In the past years, we have successfully held hundreds of charity events and helped thousands of people in
                need. Our projects cover multiple areas such as educational support, medical assistance, disaster relief
                and community development.</p>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact us</h3>
                    <p>Tel: (123) 456-7890</p>
                    <p>Email: charity@charity.com</p>
                    <p>Address: No. 123 Charity Road, Liuzhou City, Guangxi Zhuang Autonomous Region</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html" style="color: white;">Home</a><br>
                    <a href="search.html" style="color: white;">Search</a><br>
                </div>
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>A non-profit organization</p>
                    <p>Our mission is to convey love, create hope, and allow everyone to enjoy equal development
                        opportunities.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Love Charity.</p>
            </div>
        </div>
    </footer>

    <script>

        // fetch data
        async function fetchEvents() {
            try {
                const response = await fetch('http://localhost:3060/api/events');
                if (!response.ok) {
                    throw new Error('The network response is abnormal');
                }
                const events = await response.json();
                renderEvents(events);
            } catch (error) {
                console.error('Error getting event data:', error);
                eventsContainer.innerHTML = '<p>Unable to load activity data. Please try again later.</p>';
            }
        }
        // get container
        const eventsContainer = document.getElementById('events-container');

        // renderContainer
        function renderEvents(events) {

            eventsContainer.innerHTML = '';

            // filter ban_status=1
            const validEvents = events.filter(event => event.ban_status === 1);

            if (validEvents.length === 0) {
                eventsContainer.innerHTML = '<p>No event data is available.</p>';
                return;
            }

            // sort by date
            validEvents.sort((a, b) => new Date(a.date) - new Date(b.date));

            // create event carc by result
            validEvents.forEach(event => {
                const eventDate = new Date(event.date);
                const today = new Date();
                // today.setHours(0, 0, 0, 0);

                // event status
                let statusClass, statusText;
                if (event.event_status === 0) {
                    statusClass = 'status-past';
                    statusText = 'Past';
                } else if (event.event_status === 1) {
                    statusClass = 'status-upcoming';
                    statusText = 'Ongoing';
                }

                // format date
                const formattedDate = `${eventDate.getFullYear()}/${eventDate.getMonth() + 1}/${eventDate.getDate()}`;

                // eventCard
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card';
                eventCard.innerHTML = `
                        
                        <div class="event-name">${event.name}</div>
                        <div class="event-organization">${event.organization_name}</div>
                        <p>${event.detail}</p>
                        <div class="event-footer">
                            <div class="event-date">${formattedDate}</div>
                            <div class="event-actions">
                                <span class="event-status ${statusClass}">${statusText}</span>
                                <a href="detail.html?id=${event.id}" class="btn">More..</a>
                            </div>
                        
                        </div>
                    `;

                eventsContainer.appendChild(eventCard);
            });
        }

        document.addEventListener('DOMContentLoaded', fetchEvents);
    </script>
</body>

</html>